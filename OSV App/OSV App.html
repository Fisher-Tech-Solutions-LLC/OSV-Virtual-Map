<!DOCTYPE html>
<html>

<head>
    <title>OSV Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="map"></div>
    <div id="legend">
        <h3>Legend</h3>
    </div>
    <div id="directionpanel">

    </div>
    <script>
        var map;

        function initMap() {
            var directionsService = new google.maps.DirectionsService;
            var directionsDisplay = new google.maps.DirectionsRenderer;
            var mapOptions = {

                mapTypeId: google.maps.MapTypeId.ROADMAP

            }
            map = new google.maps.Map(document.getElementById('map'), {
                center: {
                    lat: 42.107979,
                    lng: -72.098670
                },
                gestureHandling: 'greedy',
                zoom: 15,
                disableDefaultUI: true,
                styles: [{
                        elementType: 'geometry',
                        stylers: [{
                            color: '#ede7c0'
                        }]
                    },
                    {
                        elementType: 'labels.text.stroke',
                        stylers: [{
                            color: '#ede7c0'
                        }]
                    },

                    {
                        elementType: 'labels.text.fill',
                        stylers: [{
                            color: '#d38476'
                        }]
                    }, {
                        featureType: 'poi',
                        elementType: 'labels.text.fill',
                        stylers: [{
                            visibility: 'off'
                        }]
                    }, {
                        featureType: 'road',
                        elementType: 'geometry.stroke',
                        stylers: [{
                            color: '#d38476'
                        }]
                    }
                ]
            });

            var rendererOptions = {
                map: map
            }

            directionsDisplay.setMap(map);

            stepDisplay = new google.maps.InfoWindow();

            infoWindow = new google.maps.InfoWindow();
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Location found.');
                    infoWindow.open(map);
                    map.setCenter(pos);
                }, function() {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }

            //bathrooms are added dynamically from JSON, once PHP is implemented this will be moved to a seperate file in the project
            var json = [{
                    "id": "1",
                    "title": "visitor center bathroom",
                    "longitude": "42.108125",
                    "latitude": "-72.098474"
                },
                {
                    "id": "2",
                    "title": "bullard bathroom",
                    "longitude": "42.106444",
                    "latitude": "-72.097345"
                },
                {
                    "id": "3",
                    "title": "countryside bathroom",
                    "longitude": "42.105160",
                    "latitude": "-72.095643"
                }
            ];

            var bathrooms = [];
            for (var i = 0; i < 3; i++) {
                var obj = json[i];
                var bathroom = new google.maps.Marker({
                    position: new google.maps.LatLng(obj.longitude, obj.latitude),
                    id: obj.id,
                    map: map,
                    icon: 'Images/bathroom icon.png',
                    title: obj.title,
                });

                bathrooms.push(bathroom);
            }

            bathrooms.forEach(function(bathroom, index) {
                bathroom.addListener('click', function() {
                    setTarget(bathroom);
                });
            });

            var potteryString = '<div id="potterycontent">' +
                '<h1 id="firstHeading" class="firstHeading">Pottery Shop</h1>' +
                '<div id="bodyContent">' +
                '<p>The <b>Pottery Shop</b>, is a favorite location for visitors, this exhibit ' +
                'is where many of the villages pottery comes from ' +
                'The pottery shop is originally from Goshen Connecticut where it was built around the year of 1819' +
                'Where the original owner Hervey Brooks produced many pieces of pottery ' +
                'from the years of 1828 to 1864 where he performed his last firing at 85 years old ' +
                '<img src= "Images/pottery shop image.jpg" height = "150px" width = "150px">'
            '</p>'
            '</div>';

            var potterywindow = new google.maps.InfoWindow({
                content: potteryString
            });

            var pot = 'Images/clay pot.png';
            var potteryshop = new google.maps.Marker({
                position: new google.maps.LatLng(
                    42.105229,
                    -72.097357
                ),
                icon: pot,
                map: map,
                title: 'Pottery Shop'
            });

            potteryshop.addListener('click', function() {
                potterywindow.open(map, potteryshop);
                setTarget(potteryshop);
            });

            var minergrantString = '<div id="minergrantcontent">' +
                '<h1 id="firstHeading" class ="firstHeading">Miner Grant Store</h1>' +
                '<div id ="bodyContent">' +
                '<p> The <b> Miner Grant Store </b>, is where visitors can find many items to bring home from their trip to the village.' +
                'These items include crafts made in the village as other items that will help you and your family remember your visit long after you leave' +
                '</p>'
            '</div>';

            var minergrantwindow = new google.maps.InfoWindow({
                content: minergrantString
            });

            var giftshop = 'Images/gift shop icon.png';
            var minergrant = new google.maps.Marker({
                position: new google.maps.LatLng(
                    42.107165,
                    -72.097722
                ),
                icon: giftshop,
                map: map,
                title: 'Miner Grant Store'
            });

            minergrant.addListener('click', function() {
                minergrantwindow.open(map, minergrant);
                setTarget(minergrant);
            });

            var barn = 'Images/barn.png';
            var freemanfarm = new google.maps.Marker({
                position: new google.maps.LatLng(
                    42.103809,
                    -72.096426
                ),
                icon: barn,
                map: map,
                title: 'Freeman Farm'
            });
            
            freemanfarm.addListener('click', function(){
                setTarget(freemanfarm);
            });

            var centermeetinghouseString = '<div id="centermeetinghousecontent">' +
                '<h1 id="firstHeading" class="firstHeading">Center Meetinghouse</h1>' +
                '<div id="bodyContent">' +
                '<p> The <b> Center Meetinghouse </b>, moved to OSV in 1947, With its steeple pointing skyward, the meetinghouse was the dominant symbol of every New England town—the gathering place for town meetings, elections, and church services. Churchgoers attended lengthy Sunday morning and afternoon services as well as midweek prayer meetings. Many 19th-century New England towns had several different meetinghouses, reflecting the region’s increase in religious diversity after the Revolutionary War. The two largest denominations in most rural towns were Congregationalists and Baptists, both descended from the Puritan Church of the first English settlers. In many rural towns, Methodists, Universalists, Episcopalians, and Friends also had their own houses of worship.' + '<br>' +
                '<img src= "Images/Center Meetinghouse image.jpg" height = "150px" width = "150px">  </p>' +
                '</div>';

            var centermeetinghousewindow = new google.maps.InfoWindow({
                content: centermeetinghouseString
            });


            var cross = 'Images/cross.png';
            var centermeetinghouse = new google.maps.Marker({
                position: new google.maps.LatLng(
                    42.106540,
                    -72.099297
                ),
                icon: cross,
                map: map,
                title: 'Center Meetinghouse'
            });

            centermeetinghouse.addListener('click', function() {
                centermeetinghousewindow.open(map, centermeetinghouse);
                setTarget(centermeetinghouse);
            });

            var schoolhouseString = '<div id = "schoolhousecontent">' +
                '<h1 id="firstHeading" class="firstHeading">District Schoolhouse</h1>' +
                '<div id="bodyContent">' +
                '<p> The <b> District Schoolhouse </b>, first moved to OSV in 1961, Long before the American Revolution, most New Englanders were required to pay taxes to provide tuition-free schools for their children. By 1800, the majority of towns were divided into districts with neighborhood schools. Schools were in session between December and March, when older children did not need to work on the farm. Younger children, too small to help with chores and likely to be underfoot, also attended school between May and August. With up to 50 students of all ages, discipline was often hard to maintain, and punishments were sometimes severe. Teachers, or “school-keepers,” were usually between 17 and 25 years old and had only a district school education themselves.' +
                '</p>'+
            '</div>';

            var schoolhousewindow = new google.maps.InfoWindow({
                content: schoolhouseString
            });

            var book = 'Images/book.png';
            var schoolhouse = new google.maps.Marker({
                position: new google.maps.LatLng(
                    42.105565,
                    -72.097745
                ),
                icon: book,
                map: map,
                title: 'Schoolhouse'
            });

            schoolhouse.addListener('click', function() {
                schoolhousewindow.open(map, schoolhouse);
                setTarget(schoolhouse);
            });

            var sheep = 'Images/sheep.png';
            var fennosheeppen = new google.maps.Marker({
                position: new google.maps.LatLng(
                    42.106754,
                    -72.099173
                ),
                icon: sheep,
                map: map,
                title: 'Fenno Sheep Pen'
            });

            fennosheeppen.addListener('click', function() {
                setTarget(fennosheeppen);
            });
            
            var sawmillString = '<div id= "sawmillcontent">'+
                '<h1 id="firstHeading" class="firstHeading">Water Powered Sawmill</h1>' +
                '<div id="bodyContent">' +
                '<p> This rare water-powered sawmill—erected on the millpond site that David Wight, Jr. first created in the 1790s—is used to cut lumber for Old Sturbridge Village and other historic sites. The Sawmill is based on what had been one of the oldest surviving sawmills in the area: the Nichols-Colby Sawmill of Bow, New Hampshire, which was destroyed in a 1938 hurricane.' +
                '</p>' +
                '</div>';
            
            var sawmillwindow = new google.maps.InfoWindow({
                content: sawmillString
            });
            
            var saw = 'Images/sawmill icon.png';
            var sawmill = new google.maps.Marker({
                position: new google.maps.LatLng(
                      42.105463,
                     -72.094925
                ),
                icon: saw,
                map: map,
                title: 'Saw Mill'
            });
            
            sawmill.addListener('click', function(){
                sawmillwindow.open(map, sawmill);
                setTarget(sawmill);
            });
            
            
          

            var legend = document.getElementById('legend');
            var bathroom = document.createElement('div');
            bathroom.innerHTML = '<img src="Images/bathroom icon.png">';
            legend.appendChild(bathroom);

            map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);

            var directionPanel = document.getElementById('directionpanel');
            var sentence = document.createElement('div');
            var button = document.createElement('div');
            button.innerHTML = '<button type="submit" form="test" value="submit" id="submit"> Go Now </button>';
            sentence.innerHTML = '<p id="sentence"> Want Direction to ' + centermeetinghouse.title + '? </p>';
            directionPanel.appendChild(sentence);
            directionPanel.appendChild(button);
            map.controls[google.maps.ControlPosition.TOP_CENTER].push(directionPanel);


            google.maps.event.addListener(map, 'zoom_changed', function() {

                var zoom = map.getZoom();
                markerWidth = (zoom / 1.5) * 2
                markerHeight = (zoom / 1.5) * 2

                for (var i = 0; i < 3; i++) {
                    var bathroom = bathrooms[i];
                    bathroom.setIcon({
                        url: "Images/bathroom icon.png",
                        scaledSize: new google.maps.Size(markerWidth, markerHeight)
                    });
                };
                //set the icon with the new size to the marker
                centermeetinghouse.setIcon({
                    url: cross,
                    scaledSize: new google.maps.Size(markerWidth, markerHeight)
                });
                potteryshop.setIcon({
                    url: pot,
                    scaledSize: new google.maps.Size(markerWidth, markerHeight)
                });
                freemanfarm.setIcon({
                    url: barn,
                    scaledSize: new google.maps.Size(markerWidth, markerHeight)
                });
                minergrant.setIcon({
                    url: giftshop,
                    scaledSize: new google.maps.Size(markerWidth, markerHeight)
                });
                fennosheeppen.setIcon({
                    url: sheep,
                    scaledSize: new google.maps.Size(markerWidth, markerHeight)
                });
                schoolhouse.setIcon({
                    url: book,
                    scaledSize: new google.maps.Size(markerWidth, markerHeight)
                });

            });

            function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                infoWindow.setPosition(pos);
                infoWindow.setContent(browserHasGeolocation ?
                    'Error: The Geolocation service failed.' :
                    'Error: Your browser doesn\'t support geolocation.');
                infoWindow.open(map);
            };

            var start;

            function calculateAndDisplayRoute(directionsService, directionsDisplay) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = {
                        lat: parseFloat(position.coords.latitude),
                        lng: parseFloat(position.coords.longitude)
                    };
                    start = pos.lat + "," + pos.lng;
                });

                var targetlat = targetobj.getPosition().lat();
                var targetlng = targetobj.getPosition().lng();
                var target = targetlat + "," + targetlng;

                directionsService.route({
                    origin: start,
                    destination: target,
                    travelMode: 'WALKING'
                }, function(response, status) {
                    if (status === 'OK') {
                        directionsDisplay.setDirections(response);
                    } else {
                        window.alert('Directions request failed due to ' + status);
                    }
                });
            };
            var targetobj = centermeetinghouse;
            var sentenceString = document.getElementById("sentence");

            function setTarget(newTarget) {
                targetobj = newTarget;
                updateSentence();
            };

            // Values below are related to listening to the directions panel added at the top of the web app
            function updateSentence() {
                sentenceString.innerHTML = null;
                sentenceString.innerHTML = 'Want Directions to ' + targetobj.title + '?';
            };

            document.getElementById('submit').addEventListener('click', function() {
                calculateAndDisplayRoute(directionsService, directionsDisplay);
            });
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCt7o7MAPRpmeCI_YQftMWcRh9xezxO5A4 	&callback=initMap" async defer></script>
</body>

</html>
